<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.breakblog.dao.CommentDao">

    <resultMap id="commentPostMap" type="Comment">
        <id property="id" column="id"/>
        <result property="author" column="author"/>
        <result property="email" column="email"/>
        <result property="site" column="site"/>
        <result property="body" column="body"/>
        <result property="timestamp" column="timestamp"/>
        <result property="fromAdmin" column="from_admin"/>
        <result property="reviewed" column="reviewed"/>
        <result property="repliedId" column="replied_id"/>
        <result property="postId" column="post_id"/>
        <association property="post" column="post_id" javaType="Post"
                     select="me.breakblog.dao.PostDao.findById">
        </association>
        <association property="comment" column="replied_id" javaType="Comment"
                     select="me.breakblog.dao.CommentDao.findById">
        </association>

    </resultMap>

    <select id="findAllByPostId" resultMap="commentPostMap">
        select * from comment where post_id = #{id}
    </select>

    <select id="findAll" resultType="Comment">
        select * from comment
    </select>

    <select id="findById" parameterType="Integer" resultType="Comment">
        select * from comment where id = #{id}
    </select>

    <insert id="addComment" parameterType="Comment">
         insert into comment (author, email, site, body, from_admin, reviewed, timestamp, replied_id, post_id) value
         ( #{author}, #{email}, #{site}, #{body}, #{fromAdmin}, #{reviewed}, #{timestamp}, #{repliedId}, #{postId} )
    </insert>

    <delete id="deleteComment" parameterType="Integer">
        delete from comment where id = #{id}
    </delete>

    <update id="updateComment" parameterType="Integer">
         update comment set reviewed = #{reviewed} where id = #{id}
    </update>
</mapper>